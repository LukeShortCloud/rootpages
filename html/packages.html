<h1 id="packages">Packages</h1>
<ul>
<li>DEB (Debian)</li>
<li><a href="#rpm">RPM (RHEL)</a>
<ul>
<li><a href="#rpm---repositories">Repositories</a>
<ul>
<li><a href="#rpm---repositories---adding-a-repository">Adding a Repository</a></li>
<li><a href="#rpm---repositories---creating-a-repository">Creating a Repository</a></li>
</ul></li>
<li><a href="#rpm---packaging">Packaging</a>
<ul>
<li><a href="#rpm---packaging---macros">Macros</a>
<ul>
<li><a href="#rpm---packaging---macros---directories">Directories</a></li>
</ul></li>
<li><a href="#rpm---packaging---users-and-groups">Users and Groups</a></li>
<li><a href="#rpm---packaging---patches">Patches</a></li>
</ul></li>
</ul></li>
<li><a href="#pkgbuild">PKGBUILD (Arch)</a>
<ul>
<li><a href="#pkgbuild---packaging">Packaging</a></li>
</ul></li>
<li><a href="#flatpak">Flatpak</a></li>
<li>Snap</li>
</ul>
<h1 id="rpm">RPM</h1>
<h2 id="rpm---repositories">RPM - Repositories</h2>
<p>Repositories (sometimes called &quot;repos&quot;) are a central location where packages can easily be found and installed from.</p>
<h3 id="rpm---repositories---adding-a-repository">RPM - Repositories - Adding a Repository</h3>
<p>On Red Hat based systems, the repositories are all defined as text files with the &quot;.repo&quot; extension in this directory.</p>
<pre><code># ls /etc/yum.repos.d/</code></pre>
<p>Here are some common options for repository files: * [] = This should be the first part of a repository, with the name being inside the brackets. * name = This should be similar to the name from the brackets. However, this friendly name can be different and is usually ignored. * baseurl = The location of the repository. Valid location types include &quot;http://&quot;, &quot;ftp://&quot;, and &quot;file://&quot; for using the local file system. * mirrorlist = Instead of a baseurl, a link to a list of repository mirrors can be given. * enabled = Enable or disable a repository with a &quot;1&quot; or &quot;0&quot;. The default is value is &quot;1&quot;. [1] * gpgcheck = Force a GPG encryption check against signed packages. Enable or disable with a &quot;1&quot; or &quot;0&quot;. * gpgkey = Specify the path to the GPG key.</p>
<p>Variables for repository files: * $releasever = The RHEL release version. This is typically the major operating system versioning number such as &quot;5&quot; or &quot;6&quot;. * $basearch = The CPU architecture. For most modern PCs this is typically either automatically filled in as &quot;x86_64&quot; for 64-bit operating systems or &quot;i386&quot; for 32-bit. [2]</p>
<p>At the bare minimum, a repository file needs to include a name and a baseurl.</p>
<pre><code>[example-repo]
name=example-repo
baseurl=file:///var/www/html/example-repo/</code></pre>
<p>Here is an example repository file for the official CentOS 7 repository using a mirrorlist.</p>
<pre><code>[base]
name=CentOS-$releasever - Base
mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra
#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</code></pre>
<p>Sources:</p>
<ol style="list-style-type: decimal">
<li>&quot;Fedora 24 System Administrator's Guide&quot; Fedora Documentation. 2016. Accessed June 28, 2016. https://docs.fedoraproject.org/en-US/Fedora/24/html/System_Administrators_Guide/sec-Setting_repository_Options.html</li>
<li>&quot;yum.conf - Configuration file for yum(8).&quot; Die. Accessed June 28, 2016. http://linux.die.net/man/5/yum.conf</li>
</ol>
<h2 id="rpm---repositories---creating-a-repository">RPM - Repositories - Creating a Repository</h2>
<p>Any directory can be used as a repository to host RPMs. The standard naming convention used for RHEL based operating systems is &quot;centos/<span class="math inline"><em>r</em><em>e</em><em>l</em><em>e</em><em>a</em><em>s</em><em>e</em><em>v</em><em>e</em><em>r</em>/</span>basearch/&quot; where $releasever is the release version and $basearch is the CPU architecture. However, any directory can be used.</p>
<p>In this example, a default Apache web server will have the repository access via the URL &quot;http://localhost/centos/7/x86_64/.&quot; Be sure to place your RPMs in this directory. [1]</p>
<pre><code># yum install createrepo
# mkdir -p /var/www/html/centos/7/x86_64/</code></pre>
<pre><code># createrepo /var/www/html/centos/7/x86_64/</code></pre>
<p>The &quot;createrepo&quot; command will create 4 or 5 files. * repomd.xml = An index for the other repository metadata files. * primary.xml = Contains metadata for all packages including the name, version, architecture, file sizes, checksums, dependencies, etc. * filelists.xml = Contains the full listing of every directory and file. * other.xml = Holds a changelog of all the packages. * groups.xml = If a repository has a &quot;group&quot; that should install multiple packages, the group is specified here. By default, this file is not created when running &quot;createrepo&quot; without any arguments. [2]</p>
<p>If new packages are added and/or signed via a GPG key then the repository cache needs to be updated again. [1]</p>
<pre><code># createrepo --update /var/www/html/centos/7/x86_64/</code></pre>
<p>Sources:</p>
<ol style="list-style-type: decimal">
<li>&quot;createrepo(8) - Linux man page.&quot; Die. Accessed June 28, 2016. http://linux.die.net/man/8/createrepo</li>
<li>&quot;createrepo/rpm metadata.&quot; createrepo. Accessed June 28 2016. http://createrepo.baseurl.org/</li>
</ol>
<h2 id="rpm---packaging">RPM - Packaging</h2>
<p>An RPM is built from a &quot;spec&quot; file. This modified shell script contains all of the information about the program and on how to install and uninstall it. It is used to build the RPM.</p>
<p>Common variables:</p>
<ul>
<li>Name = The name of the program.
<ul>
<li><code>%{name}</code></li>
</ul></li>
<li>Version = The version of the package. Typically this is in the format of X.Y.Z (major.minor.bugfix) or ISO date format (for example, &quot;2016-01-01&quot;).
<ul>
<li><code>%{version}</code></li>
</ul></li>
<li>Release = Start with &quot;1%{?dist}&quot; for the first build of the RPM. Increase the number if the package is ever rebuilt. Start from &quot;1%{?dist}&quot; if a new version of the actual program is being built.</li>
<li>Summary = One sentence describing the package. A period is not allowed at the end.</li>
<li>BuildRoot = The directory that contains all of the RPM packages. The directory structure under here should mirror the files location in relation to the top-level root &quot;/&quot;. For example, &quot;/bin/bash&quot; would be placed under &quot;$RPM_BUILD_ROOT/bin/bash&quot;.</li>
<li>BuildArch = The architecture that the program is meant to run on. This is generally either &quot;x86_64&quot; or &quot;i386.&quot; If the code is not dependent on the CPU (for example: Java programs, shell scripts, documentation, etc.) then &quot;noarch&quot; can be used.</li>
<li>Requires = List the RPM packages that are dependencies needed for your program to work.</li>
<li>License = The license of the program.</li>
<li>URL = A URL link to the program's or, if that is not available, the developer's website.</li>
<li>Source = A tarball of the source code. It should follow the naming standard of <code>&lt;RPM_NAME&gt;-&lt;RPM_PROGRAM_VERSION&gt;.tar.gz</code>.</li>
</ul>
<p>Sample SPEC file:</p>
<pre><code>Name: my-first-rpm
Version: 1.0.0
Release: 1%{?dist}
Summary: This is my first RPM
License: GPLv3
URL: http://example.tld/</code></pre>
<p>If you want to build the RPM, simply run:</p>
<pre><code># rpmbuild -bb &lt;SPECFILE&gt;.spec</code></pre>
<p>In case you also want to build a source RPM (SRPM) run:</p>
<pre><code># rpmbuild -ba &lt;SPECFILE&gt;.spec</code></pre>
<p>Sections:</p>
<ul>
<li><code>%description</code> = Provide a description of the program.</li>
<li><code>%prep</code> = Define how to extract the source code for building.</li>
<li><code>%setup</code> =</li>
<li><code>%build</code> = This is where the program is built from the source code.</li>
<li><code>%install</code> = Copy files to a directory structure under <code>%{buildroot}</code> that mirrors where their installed location. The <code>%{buildroot}</code> is the top-level directory of a typical Linux file system hiercharchy.</li>
<li><code>%file</code> = These are the files that should be copied over during installation. Permissions can also be set.
<ul>
<li><code>%attr(&lt;MODE&gt;, &lt;USER&gt;, &lt;GROUP&gt;)</code> = Define this in front of a file or folder to give it custom permissions.</li>
</ul></li>
</ul>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;How to create an RPM package.&quot; Fedora Project. June 22, 2016. Accessed June 28, 2016. http://fedoraproject.org/wiki/How_to_create_an_RPM_package</li>
</ol>
<h3 id="rpm---packaging---macros">RPM - Packaging - Macros</h3>
<p>Macros are variables in the RPM spec file that are expanded upon compilation of the RPM.</p>
<p>Some useful macros include:</p>
<ul>
<li><code>%{patches}</code> = An array of all of the defined patch files.</li>
<li><code>%{sources}</code> = An array of all of the defined source files.</li>
</ul>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>https://fedoraproject.org/wiki/How_to_create_an_RPM_package</li>
</ol>
<h4 id="rpm---packaging---macros---directories">RPM - Packaging - Macros - Directories</h4>
<p>During the creation of an RPM there are a few important directories that can and will be refereneced.</p>
<ul>
<li>%{topdir} = The directory that the RPM related files should be located. By default this is set to <code>%{getenv:HOME}/rpmbuild</code>.</li>
<li>%{builddir} = The <code>%{_topdir}/BUILD</code> directory. This is where the compilation of the program should take place.</li>
<li>%{_sourcedir} = The <code>%{_topdir}/SOURCES</code> directory. This is where patches, service files, and source code can be stored.</li>
<li>%{_specdir} = The <code>%{_topdir}/SPECS</code> directory. This is where the SPEC file for the RPM should be stored.</li>
<li>%{_srcrpmdir} = The <code>%{_topdir}/SRPMS</code> directory. This is where the optional source RPM will be compiled and stored to.</li>
<li>%{buildroot} = The <code>%{_topdir}/BUILDROOT</code> directory. This is the file system hierarchy of where the RPM files will actually be installed to. This is also set to the <code>$RPM_BUILD_ROOT</code> shell variable.</li>
</ul>
<p>[1]</p>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;Packaging:RPMMacros.&quot; Fedora Project Wiki. December 1, 2016. Accessed March 13, 2017. https://fedoraproject.org/wiki/Packaging:RPMMacros?rd=Packaging/RPMMacros</li>
</ol>
<h3 id="rpm---packaging---users-and-groups">RPM - Packaging - Users and Groups</h3>
<p>Creating a user or group can be done one of two ways.</p>
<ul>
<li>Dynamically = Let the system deciede what user identification number (UID) and group ID (GID) to use.</li>
<li>Static = Specify a specific UID or GID number to use. This is useful for keeping permissions identifical on multiple platforms.</li>
</ul>
<p>The Fedora Project recommends using these standarized blocks of code to accomplish these methods. [1]</p>
<p>Dynamic:</p>
<pre><code>Requires(pre): shadow-utils
[...]
%pre
getent group &lt;GROUP_NAME&gt; &gt;/dev/null || groupadd -r &lt;GROUP_NAME&gt;
getent passwd &lt;USER_NAME&gt; &gt;/dev/null || \
    useradd -r -g &lt;GROUP_NAME&gt; -s /sbin/nologin \
    -c &quot;&lt;USER_DESCRIPTION&gt;&quot; &lt;USER_NAME&gt;
exit 0</code></pre>
<p>Static:</p>
<pre><code>Requires(pre): shadow-utils
&lt;OMITTED&gt;
%pre
getent group &lt;GROUP_NAME&gt; &gt;/dev/null || groupadd -f -g &lt;GID&gt; -r &lt;GROUP_NAME&gt;
if ! getent passwd &lt;USER_NAME&gt; &gt;/dev/null ; then
    if ! getent passwd &lt;UID&gt; &gt;/dev/null ; then
      useradd -r -u &lt;UID&gt; -g &lt;GROUP_NAME&gt; -s /sbin/nologin -c &quot;Useful comment about the purpose of this account&quot; &lt;USER_NAME&gt;
    else
      useradd -r -g &lt;GROUP_NAME&gt; -s /sbin/nologin -c &quot;&lt;USER_DESCRIPTION&gt;&quot; &lt;USER_NAME&gt;
    fi
fi
exit 0</code></pre>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;Packaging: Users and Groups&quot; Fedora Project. September 14, 2016. Accessed February 25, 2017. https://fedoraproject.org/wiki/Packaging:UsersAndGroups</li>
</ol>
<h3 id="rpm---packaging---patches">RPM - Packaging - Patches</h3>
<p>Some applications may require patches to work properly. Pathces should be stored in the <code>SOURCES</code> directories. At the beginning of the spec file, where the name and version information is defined, patch file names can also be defined.</p>
<p>Usage:</p>
<pre><code>Patch&lt;NUMBER&gt;: &lt;PATCH_FILE&gt;</code></pre>
<p>Example:</p>
<pre><code>Patch0: php-fpm_listen_port.patch
Patch1: php_memory_limit.patch</code></pre>
<p>These patches can then be referenced in the <code>%setup</code> phase (after <code>%prep</code> and before <code>%build%</code>).</p>
<pre><code>%setup -q</code></pre>
<p>A patched file can be created using the <code>diff</code> command.</p>
<pre><code>$ diff -u &lt;ORIGINAL_FILE&gt; &lt;PATCHED_FILE&gt; &gt; &lt;PATCH_NAME&gt;.patch</code></pre>
<p>If multiple files in a directory have been patched, a more comphrensive patch file can be made.</p>
<pre><code>$ diff -urN &lt;ORIGINAL_SOURCE_DIRECTORY&gt;/ &lt;PATCHED_SOURCE_DIRECTORY&gt;/ &gt; &lt;PATCH_NAME&gt;.patch</code></pre>
<p>In the spec file, the <code>%patch</code> macro can be used. The <code>-p1</code> argument strips off the top-level directory of the patch's path.</p>
<p>Syntax:</p>
<pre><code>%patch0 -p1
%patch1 -p1</code></pre>
<p>Example patch file:</p>
<pre><code>--- d20-1.0.0_patched/src/dice.h
+++ d20-1.0.0/src/dice.h</code></pre>
<p>A patch can also be made without the <code>%patch</code> macro by specifiying the location of the patch file.</p>
<pre><code>patch &lt; %{_sourcedir}/&lt;FILE_NAME&gt;</code></pre>
<p>[1]</p>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;How to Create and Use Patch Files for RPM Packages.&quot; Bob Cromwell. March 20, 2017. Accessed March 20, 2017. http://cromwell-intl.com/linux/rpm-patch.html</li>
</ol>
<h1 id="pkgbuild">PKGBUILD</h1>
<h2 id="pkgbuild---packaging">PKGBUILD - Packaging</h2>
<p>Arch Linux packages are design to be simple and easy to create. A PKGBUILD file is compressed with a software's contents into a XZ tarball. This can contain either the source code or compiled program.</p>
<p>Required Variables:</p>
<ul>
<li>pkgname = Name of the software.</li>
<li>pkgver = Version of the software.</li>
<li>pkgrel = Version of the package (only increase if the PKGBUILD file has been modified and not the software).</li>
<li>arch = The architecture the software is built for. Any architecture that applies should be defined. Valid options: x86_64, i686, arm (armv5), armv6h, armv7h, aarch64 (armv8 64-bit), or any.</li>
</ul>
<p>Optional Variables:</p>
<ul>
<li>pkgdesc = A brief description of the software.</li>
<li>url = The URL of the software's website.</li>
<li>license = The license of the software. Valid options: GPL, BSD, MIT, Apache, etc.</li>
<li>depends = List other package version dependencies.</li>
<li>optdepends = List optional dependencies and a brief description.</li>
<li>makedepends = List packages required to build the software from source.</li>
<li>provides = List tools that are provided by the package but do not necessarily have file names.</li>
<li>conflicts = List any conflicting packages.</li>
<li>replaces = List packages that this software should replace.</li>
</ul>
<p>[1]</p>
<p>Functions</p>
<p>Required:</p>
<ul>
<li>build()
<ul>
<li><p>For building the software, PKGBUILD will need to move into the directory that the XZ tarball was extracted to. This is automatically generated as the &quot;srcdir&quot; variable. In most situations this should be the package name and version separated by a dash.</p>
<pre><code>$ cd &quot;${srcdir}&quot;</code></pre>
<p>OR</p>
<pre><code>$ cd &quot;${pkgname}-${pkgver}&quot;</code></pre></li>
</ul></li>
<li>package()
<ul>
<li><p>These are the steps to copy and/or modify files from the &quot;srcdir&quot; to be placed in the &quot;pkgdir&quot; to represent where they will be installed on an end-user's system. This acts as the top-level directory of a Linux filesystem hierarchy.</p>
<pre><code>$ cd &quot;${pkgdir}&quot;</code></pre></li>
<li><p>An example of installing compiled source code using a Make file.</p>
<pre><code>$ make DESTDIR=&quot;${pkgdir}&quot; install</code></pre>
<p>[2][3]</p></li>
</ul></li>
</ul>
<p>Sources:</p>
<ol style="list-style-type: decimal">
<li>&quot;PKGBUILD.&quot; Arch Linux Wiki. October 26, 2016. Accessed November 19, 2016. https://wiki.archlinux.org/index.php/PKGBUILD</li>
<li>&quot;Creating packages.&quot; Arch Linux Wiki. July 30, 2016. Accessed November 19, 2016. https://wiki.archlinux.org/index.php/creating_packages</li>
<li>&quot;PKGBUILD(5) Manual Page.&quot; Arch Linux Man Pages. February 26, 2016. Accessed November 19, 2016. https://www.archlinux.org/pacman/PKGBUILD.5.html</li>
</ol>
<h1 id="flatpak">Flatpak</h1>
<p>Flatpak is a sandbox solution to providing a universal application packaging. It was first started by an employee from Red Hat in their spare time. Flatpak has a strong focus on portability, security, and effective space usage. [1]</p>
<p>This package manager is available for most modern Linux distributions. [2] RHEL does not have an official package but unofficial RPMs are provided here: <a href="https://copr.fedorainfracloud.org/coprs/amigadave/flatpak-epel7/" class="uri">https://copr.fedorainfracloud.org/coprs/amigadave/flatpak-epel7/</a>.</p>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;About <a href="#flatpak">Flatpak</a>.&quot; Flatpak. March 18, 2017. Accessed March 19, 2017. http://flatpak.org/</li>
<li>&quot;Getting Flatpak.&quot; Flatpak. March 18, 2017. Accessed March 19, 2017. http://flatpak.org/getting.html</li>
</ol>
