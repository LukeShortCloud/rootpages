<h1 id="bootloaders">Bootloaders</h1>
<ul>
<li><a href="#grub-2">GRUB 2</a></li>
<li><a href="#configuring-grub-2">Configuring GRUB 2</a></li>
<li><a href="#installing-grub-2">Installing GRUB 2</a></li>
<li><a href="#grub-2-recovery">GRUB 2 Recovery</a></li>
</ul>
<h2 id="grub-2">GRUB 2</h2>
<p>GRUB stands for the GRand Unified Bootloader. It was designed to be cross platform compatible with most operating systems including BSD, Linux, and Windows variants.</p>
<h3 id="configuring-grub-2">Configuring GRUB 2</h3>
<p>Important files:</p>
<table style="width:24%;">
<colgroup>
<col width="6%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th>FILE</th>
<th>DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>/etc/default/grub</td>
<td>GRUB settings.</td>
</tr>
<tr class="even">
<td>/etc/grub.d/</td>
<td>A folder with various scripts that make up the grub.cfg. Scripts prefixed with lower numbers are executed first.</td>
</tr>
<tr class="odd">
<td>/boot/grub/grub.cfg</td>
<td>This is automatically generated using the settings from /etc/default/grub and the scripts in /etc/grub.d/. Manual changes may get overwritten.</td>
</tr>
</tbody>
</table>
<p>Common Options: * /etc/default/grub * GRUB_DEFAULT = The default menu entry to autoboot into. Valid options are: * Use the menu position &quot;0&quot;, use the selected menu option from the last boot &quot;saved&quot;, or verbosely specific the menu name to load. * GRUB_TIMEOUT = Set the timeout (in seconds) before booting into the default menu entry. * GRUB_CMDLINE_LINUX = Append kernel options to the end of the &quot;linux&quot; line. These can later be seen in the operating system in /proc/cmdline. This applies to both the normal and recovery mode options. * GRUB_CMDLINE_LINUX_DEFAULT = The same as the above setting except this option does not affect the recovery kernel options. * GRUB_DISABLE_LINUX_UUID = If set to &quot;true&quot;, devices from /dev/ will be used for specifying the root instead of the UUID. The default is &quot;false&quot; which will use UUIDs. * GRUB_BACKGROUND = Specify the full path to a custom image for GRUB's menu background.</p>
<p>[1]</p>
<p>Source: 1. &quot;GRUB2/Setup.&quot; Ubuntu Documentation. November 29, 2015. https://help.ubuntu.com/community/Grub2/Setup</p>
<h3 id="installing-grub-2">Installing GRUB 2</h3>
<p>GRUB must be installed onto the start of the entire drive, not a partition, to avoid issues in the case of partitions needing to be modified. The first 512 bytes of a drive are used for the Master Boot Record (MBR). If you are using a GPT partition then it uses the first 2048 bytes. GRUB will add it's own data right after that. It is usually a safe and recommended option to create your first partition 1MB after the start of the drive, especially if GPT is in use.</p>
<p>Install GRUB to a drive (replace &quot;X&quot;) and then generate a boot menu configuration file. This will create the menu file that loads up to the end-user upon boot.</p>
<pre><code># grub-install /dev/sdX
# grub-mkconfig -o /boot/grub/grub.cfg</code></pre>
<p>If any changes are made to GRUB's settings and/or it's various scripts, run this command to update the changes. [1]</p>
<pre><code># update-grub</code></pre>
<p>Common &quot;grub-install&quot; options: * compress = Compress GRUB-related files. Valid options are: * no (default), xz, gz, lzo * --modules = List kernel modules that are required for boot. Depending on the end-user's setup, &quot;lvm&quot;, &quot;raid&quot; (for mdadm), and/or &quot;encrypt&quot; (for LUKS) may be required. * --force = Install despite any warnings. * --recheck = Remove the original /boot/grub/device.map file (if it exists) and then review the current mapping of partitions. * --boot-directory = The directory that the &quot;grub/&quot; folder should exist in. This is typcially &quot;/boot&quot;. [2]</p>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;GRUB.&quot; Arch Linux Wiki. May 27, 2016. https://wiki.archlinux.org/index.php/GRUB</li>
<li>&quot;GRUB2-INSTALL MAN PAGE.&quot; Mankier. Feburary 26, 2014. https://www.mankier.com/8/grub2-install</li>
</ol>
<h3 id="grub-2-recovery">GRUB 2 Recovery</h3>
<p>In cases where GRUB fails (because it was installed incorrectly), the end-user is automatically switched into GRUB's rescue shell. Only a few commands are available for use.</p>
<p>Common options: * insmod = Load kernel modules. * ls = List partitions and file systems within them. * cat = View file contents. * set = Set a boot option. * unset = Remove a boot option. * boot = Attempt to boot again. * halt = Shutdown the computer. * reboot = Restart the computer.</p>
<p>The rescue prompt will look similar to this.</p>
<pre><code>grub rescue&gt;</code></pre>
<p>Example of using these commands to do a custom rescue boot.</p>
<pre><code>grub rescue&gt; ls
(hd0) (hd0,msdos1)
grub rescue&gt; ls (hd0,1)/boot/
grub/
vmlinuz
initramfs-linux.img
grub rescue&gt; set root=(hd0,1)
grub rescue&gt; linux /boot/vmlinuz root=/dev/sda1
grub rescue&gt; initrd /boot/initramfs-linux.img
grub rescue&gt; boot</code></pre>
<p>Alternatively, you can switch back to the graphical GRUB menu and make changes there.</p>
<pre><code>grub rescue&gt; insmod normal
grub rescue&gt; normal</code></pre>
<p>For recovering from a corrupt GRUB installation, fully change root into the environment from a live CD, USB, or PXE network boot. Then you can modify configuration files and re-install GRUB using the same commands used during the installation.</p>
<p>In this example, /dev/sda2 is the root partition and /dev/sda1 is the boot partition.</p>
<pre><code># mount /dev/sda2 /mnt
# mount /dev/sda1 /mnt/boot
# mount --bind /dev /mnt/dev
# mount --bind /run /mnt/run
# mount --bind /sys /mnt/sys
# chroot /mnt
# /bin/bash
# export PATH=&quot;$PATH:/sbin:/bin&quot;</code></pre>
<p>[1]</p>
<p>If you need to recover GRUB from a chroot that is based on a LVM on the host node, make sure that LVM tools are installed on the guest. This way it can properly see the logical volume as a block device.</p>
<pre><code>Debian/Ubuntu
# apt-get install lvm2</code></pre>
<pre><code>RHEL/Fedora
# yum install lvm2</code></pre>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;Grub2/Installing.&quot; Ubuntu Documentation. March 6, 2015. https://help.ubuntu.com/community/Grub2/Installing</li>
<li>&quot;GNU GRUB Manual 2.00.&quot; GNU. Accessed June 27, 2016. https://www.gnu.org/software/grub/manual/grub.html</li>
</ol>
