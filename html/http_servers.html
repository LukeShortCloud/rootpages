<h1 id="http-servers">HTTP Servers</h1>
<ul>
<li><a href="#apache-2.4">Apache 2.4</a></li>
<li><a href="#apache---configuration">Configuration</a></li>
<li><a href="#apache---virtual-hosts">Virtual Hosts</a></li>
<li><a href="#apache---directories">Directorties</a></li>
<li><a href="#apache---authentication">Authentication</a></li>
<li><a href="#apache---cgi">CGI</a></li>
<li><a href="#apache---selinux">SELinux</a></li>
<li>Nginx</li>
<li>Lighttpd</li>
</ul>
<h1 id="apache-2.4">Apache 2.4</h1>
<p>The Apache HTTP Server Project is designed to provide a versatile open source HTTP and HTTPS web server. It has been one, and continues to be, one of peoples' favorite web servers. [1]</p>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;The Number One HTTP Server On The Internet.&quot; Apache HTTP Server Project. Accessed October 1, 2016. https://httpd.apache.org/</li>
</ol>
<h2 id="apache---configuration">Apache - Configuration</h2>
<p>There is generally one primary Apache configuration file that then includes other possible configuration files.</p>
<p>RHEL/Fedora</p>
<pre><code>/etc/http/conf/httpd.conf</code></pre>
<p>Debian/Ubuntu</p>
<pre><code>/etc/apache2/apache2.conf</code></pre>
<p>Main Options: * ServerRoot = Specify what directory Apache should use as a relative path. * Example: ServerRoot &quot;/etc/httpd&quot; * Listen = What port (and optionally aaddress) Apache should listen on. * Example #1: Listen 127.0.0.1:80 * Example #2: Listen 443 * User = The user that Apache should be run as. * Example: User apache * Group = The group that Apache should be run with. * ServerAdmin = Provide an e-mail address that will get e-mails when there are any errors. * LogLevel = Specify how verbose logging should be. * error * warn * info * debug * ErrorDocument = Provide a custom page for specific error numbers. This can either be text, a file, script, or redirect. * Example #1: ErrorDocument 500 &quot;Contact your System Administrator for help. Thank you.&quot; * Examlpe #2: ErrorDocument 403 &quot;/cgi-bin/you_didnt_say_the_magic_word.py&quot; * ErrorLog = The file to use for the error log. * CustomLog = The file to use for logging Apache access information. * IncludeOptional = Specify what directory (under ServerRoot) to load other configurations from. * Example: IncludeOptional conf.d/*.conf</p>
<p>[1]</p>
<p>Verify that the configuration is correct with one of these commands:</p>
<pre><code># apachectl configtest</code></pre>
<pre><code># httpd -t</code></pre>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;Configure the /etc/httpd/conf/httpd.conf file.&quot; Securing and Optimizing Linux. 2000. Accessed October 1, 2016. http://www.tldp.org/LDP/solrhe/Securing-Optimizing-Linux-RH-Edition-v1.3/chap29sec245.html</li>
</ol>
<h2 id="apache---virtual-hosts">Apache - Virtual Hosts</h2>
<p>A virtual host file is part of the configuration that is required for Apache to load a domain.</p>
<p>Syntax:</p>
<pre><code>&lt;VirtualHost *:80&gt;
&lt;/VirtualHost&gt;</code></pre>
<p>Options: * ServerName = The main domain name for the virtual host. * ServerAlias = Other domains associated with the virtual host * DocumentRoot = The directory where the domain loads its files from. * DirectoryIndex = The main file that is loaded up in a directory, if found. Default: &quot;index.html&quot; or &quot;index.htm.&quot; * LogLevel, ErroLog, and CustomLog = Refer to the <a href="#apache---configuration">Apache Configuration</a> section.</p>
<p>Example:</p>
<pre><code>&lt;VirtualHost 127.0.0.1:80&gt;
  ServerName  rootpages.tld
  ServerAlias www.rootpages.tld
  DirectoryIndex index.html
  DocumentRoot /var/www/html/rootpages/
  LogLevel warn
  ErrorLog /var/log/httpd/rootpages_tld.error_log
  CustomLog /var/log/httpd/rootpages_tld.custom_log
&lt;/VirtualHost&gt;</code></pre>
<p>[1]</p>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;Set up Apache virtual hosts on Ubuntu.&quot; Rackspace Network Support. July 8, 2016. Accessed October 1, 2016. https://support.rackspace.com/how-to/set-up-apache-virtual-hosts-on-ubuntu/</li>
</ol>
<h2 id="apache---files-directories-and-locations">Apache - Files, Directories, and Locations</h2>
<p>Different settings can be used on items based on if a matched file, directory, or location is found. Regular expressions can be used to match different areas.</p>
<ul>
<li>File = Match a specific file name.</li>
<li><p>Syntax:</p>
<pre><code>&lt;File &quot;/path/to/file.html&quot;&gt;
&lt;/File&gt;</code></pre></li>
<li>Directory = Match a specific directory name.</li>
<li><p>Syntax:</p>
<pre><code>&lt;Directory &quot;/path/to/dir&quot;&gt;
&lt;/Directory&gt;</code></pre></li>
<li>Location = Match any location. This can be a directory, alias, or a redirect path.</li>
<li><p>Syntax:</p>
<pre><code>&lt;Location &quot;/path/to/location&quot;&gt;
&lt;/Location&gt;</code></pre></li>
</ul>
<p>Options: * Require = Set an access control list to allow certain hosts or IPs. * all = Apply the rule to all hosts. * host = Apply the rule to a specific host. * ip = Apply the rule to an IP address * granted = Allow the matched rule. * denied = Deny th ematched rule. * Require not [all|host|ip] = Deny access to a host or IP. This should be configured after a Require rule. [1] * Options = Specify attributes of the matched area. Enable an option with a &quot;+&quot; or disable it with &quot;-&quot;. If no sign is present, Apache assumes it should be enabled. If at least one option requires a sign then all of the other options will need a sign. * All = Allow of the options. * ExecGI = Allow CGI scripts to be executed. * Includes = Allow HTML include functionality to include files server-side. * IncludesNOEXEC = The same as Includes but it does not allow HTML files to execute commands or scripts. * Indexes = Show the content of a directory if the DirectoryIndex is not found. * FollowSymLinks = Allow symlinks to different directories. [2]</p>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;Access Control.&quot; Apache HTTP Server Project. Accessed October 1, 2016. https://httpd.apache.org/docs/2.4/howto/access.html</li>
<li>&quot;Options Directive.&quot; Apache HTTP Server Project. Accessed October 1, 2016. http://httpd.apache.org/docs/2.4/mod/core.html#options</li>
</ol>
<h2 id="apache---authentication">Apache - Authentication</h2>
<p>Locations can be secured by a username and password. Users can also be assigned to groups.</p>
<p>Create an Apache user.</p>
<pre><code># htpasswd -c /etc/httpd/conf.d/passwd &lt;USER1&gt;</code></pre>
<p>Another user can be appended to this file by ommitting the &quot;-c&quot; create option.</p>
<pre><code># htpasswd /etc/httpd/conf.d/passwd &lt;USER2&gt;</code></pre>
<p>A new file can be created to assign multiple users to a group.</p>
<pre><code># vim /etc/httpd/conf.d/group
&lt;GROUP&gt;: &lt;USER1&gt; &lt;USER2&gt;</code></pre>
<p>Authentication can now be applied to any location. [1] The syntax is:</p>
<pre><code>AuthType Basic
AuthName &quot;Login Prompt Text&quot;
AuthUserFile &quot;/path/to/passwd/file&quot;
AuthGroupFile &quot;/path/to/group/file&quot;
Require [user|group] &lt;USER|GROUP&gt;</code></pre>
<p>Example #1:</p>
<pre><code>&lt;Directory &quot;/var/www/html&quot;&gt;
    AuthType Basic
    AuthName &quot;Please Login&quot;
    AuthUserFile &quot;/etc/httpd/conf.d/joe_passwd&quot;
    Require user joe
&lt;/Directory&gt;</code></pre>
<p>Example #2:</p>
<pre><code>&lt;File &quot;/var/www/html/grades/spring_2016_grades.csv&quot;&gt;
    AuthType Basic
    AuthName &quot;Spring 2016 Class Login&quot;
    AuthUserFile &quot;/etc/httpd/conf.d/passwds&quot;
    AuthGroupFile &quot;/etc/httpd/conf.d/spring_2016&quot;
    Require group spring_2016
&lt;/File&gt;</code></pre>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;Authentication and Authorization.&quot; Apache HTTP Server Project. Accessed October 1, 2016. https://httpd.apache.org/docs/2.4/howto/auth.html</li>
</ol>
<h2 id="apache---cgi">Apache - CGI</h2>
<p>The common gateway interface (CGI) is a method of the web server executing a script and then sending the results to a web browser.</p>
<p>In the main configuration, the new CGI bin folder has to be aliased to /cgi-bin/. This way Apache knows that this should be a CGI folder.</p>
<pre><code>ScriptAlias &quot;/cgi-bin/&quot; &quot;/path/to/custom/cgi-bin/&quot;</code></pre>
<p>Then the directory can be configured. It needs to allow the execution of CGI, set everything in the folder to be executable via the cgi-script handler, and allow access to it.</p>
<pre><code>&lt;Directory &quot;/path/to/custom/cgi-bin/&quot;&gt;
    Options +ExecCGI
    SetHandler cgi-script
    Require all granted
&lt;/Directory&gt;</code></pre>
<p>All CGI scripts have to either be a binary or have a shebang that indicates the path to the binary that should execute the program. An example shebang is &quot;#!/bin/bash.&quot; The program will also need to first print out &quot;Content-type: text/html&quot; so the web browser knows that it is a HTML page. An example is shown below.</p>
<pre><code>#!/bin/bash
echo &quot;Content-type: text/html&quot;
echo &quot;CGI Test Page&quot;</code></pre>
<p>All scripts should have readable and executable Unix permissions by the anonymous user (&quot;other&quot;) access category.</p>
<pre><code># chmod -R o+rx /path/to/custom/cgi-bin/</code></pre>
<p>[1]</p>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>&quot;Apache Tutorial: Dynamic Content with CGI.&quot; Apache HTTP Server Project. Accessed October 1, 2016. https://httpd.apache.org/docs/2.4/howto/cgi.html</li>
</ol>
<h2 id="apache---selinux">Apache - SELinux</h2>
<p>Red Hat Enterprise Linux and related distributions use SELinux as an extra layer of security. In this case, by having SELinux, this ensures that a compromised Apache cannot listen on non-standard ports or access directories outside of it's scope. There may be cases where an administrator needs to expand Apache's access so SELinux permissions will need to be modified.</p>
<p>Install the troubleshooting utilities:</p>
<pre><code># yum install setroubleshoot</code></pre>
<p>View the current Apache ports allowed by SELinux:</p>
<pre><code># semanage port -l | grep ^http_port_t
http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000</code></pre>
<p>Add a new allowed TCP port:</p>
<pre><code># semanage port -a -t http_port_t -p tcp &lt;PORT_NUMBER&gt;</code></pre>
<p>Lookup the Apache SELinux file context permissions. It should be &quot;httpd_sys_content_t.&quot;</p>
<pre><code># ls -lahZ /var/www/html/
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 .
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 ..</code></pre>
<p>Permanetely fix SELinux permissions on a custom directory using the semanage tool and then apply the permissions by running restorecon:</p>
<pre><code># semanage fcontext -a -t httpd_sys_content_t &quot;/path/to/custom/dir(/.*)?&quot; 
# restorecon -Rv /path/to/custom/dir</code></pre>
<p>Source:</p>
<ol style="list-style-type: decimal">
<li>https://wiki.centos.org/HowTos/SELinux</li>
</ol>
