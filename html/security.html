<h1 id="security">Security</h1>
<ul>
<li>Permissions</li>
<li>Ownership
<ul>
<li>Extended ACL</li>
</ul></li>
<li>Access
<ul>
<li>sticky</li>
<li>setuid</li>
<li>setguid</li>
</ul></li>
<li>Firewalls</li>
<li>iptables</li>
<li>firewalld</li>
<li>ufw</li>
<li>SELinux</li>
<li><a href="#authentication">Authentication</a></li>
<li>LDAP</li>
<li><a href="#authentication---kerberos">Kerberos</a>
<ul>
<li><a href="#authentication---kerberos---configuration">Configuration</a></li>
</ul></li>
</ul>
<h1 id="authentication">Authentication</h1>
<h2 id="authentication---kerberos">Authentication - Kerberos</h2>
<p>Kerberos provides authentication for services over a network. A Kerberos server provides remote users with a &quot;ticket&quot; to use after they log in. This ticket is used to validate authentication with various services including FTP, SSH, NFS, etc. [1]</p>
<p>Ports: * 88 TCP/UDP * 464 TCP/UDP * 749 TCP/UDP * 6620 TCP/UDP * 6621 TCP/UDP * 6623 TCP/UDP [2]</p>
<h3 id="authentication---kerberos---configuration">Authentication - Kerberos - Configuration</h3>
<p>The Kerbero sever is referred to as the Kerberos Distribution Center (KDC). These packages will need to be installed for the service:</p>
<p>RHEL</p>
<pre><code># yum install krb5-server krb5-workstation pam_krb5</code></pre>
<p>Ubuntu</p>
<pre><code># apt-get install krb5-kdc krb5-admin-server libpam-krb5</code></pre>
<p>Arch</p>
<pre><code># pamcan -S krb5 pam-krb5</code></pre>
<p>The principal database needs to be generated. First replace &quot;EXAMPLE.COM&quot; with the domain to be used. For this example, the realm &quot;ROOTPAGES.TLD&quot; will be used.</p>
<ul>
<li><p>/var/kerberos/krb5kdc/kdc.conf</p>
<pre><code>[kdcdefaults]
 kdc_ports = 88
 kdc_tcp_ports = 88
[realms]
 ROOTPAGES.TLD = {
  #master_key_type = aes256-cts
  acl_file = /var/kerberos/krb5kdc/kadm5.acl
  dict_file = /usr/share/dict/words
  admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab
  supported_enctypes = aes256-cts:normal aes128-cts:normal des3-hmac-sha1:normal arcfour-hmac:normal camellia256-cts:normal camellia128-cts:normal des-hmac-sha1:normal des-cbc-md5:normal des-cbc-crc:normal
 }</code></pre></li>
<li><p>/var/kerberos/krb5kdc/adm5.acl</p>
<pre><code>*/admin@ROOTPAGES.TLD   *</code></pre></li>
</ul>
<p>The principal is made by running the command below. It will create a new database and associated files for the realm &quot;ROOTPAGES.TLD.&quot;</p>
<pre><code># kdb5_util create -s -r ROOTPAGES.TLD</code></pre>
<p>Uncomment all of the lines in /etc/krb5.conf and then replace all references to &quot;example.com&quot; and EXAMPLE.COM&quot; with the server's domain name/realm.</p>
<pre><code>[logging]
 default = FILE:/var/log/krb5libs.log
 kdc = FILE:/var/log/krb5kdc.log
 admin_server = FILE:/var/log/kadmind.log

[libdefaults]
 dns_lookup_realm = false
 ticket_lifetime = 24h
 renew_lifetime = 7d
 forwardable = true
 rdns = false
 default_realm = ROOTPAGES.TLD
 default_ccache_name = KEYRING:persistent:%{uid}

[realms]
 ROOTPAGES = {
  kdc = kdc.rootpages.tld
  admin_server = kdc.rootpages.tld
 }

[domain_realm]
 .rootpages.tld = ROOTPAGES.TLD
 rootpages.tld = ROOTPAGES.TLD</code></pre>
<p>Start the KDC service.</p>
<pre><code># systemctl start krb5kdc</code></pre>
<p>Optionally, the admin authentication service can be started to allow remote management.</p>
<pre><code># systemctl start kadmin</code></pre>
<p>Now define the root user and KDC host as allowed principals.</p>
<pre><code># kadmin.local -p root/admin
kadmin: addprinc root/admin
kdamin: addprinc -randkey host/kdc.rootpages.tld</code></pre>
<p>Additional Kerberos users can also be created.</p>
<pre><code>kadmin: addprinc cloud-user</code></pre>
<p>Allow Kerberos authentication via SSH.</p>
<pre><code># vim /etc/ssh/sshd_config
GSSAPIAuthentication yes
GSSAPICleanupCredentials yes
# vim /etc/ssh/ssh_config
Host *
   GSSAPIAuthentication yes
   GSSAPIDelegateCredentials yes
# systemctl reload sshd</code></pre>
<p>Allow remote authentication through this KDC.</p>
<pre><code># authconfig --enablekrb5 --update</code></pre>
<p>Verify that the authentication works.</p>
<pre><code># su - cloud-user
$ kinit cloud-user
$ klist</code></pre>
<p>[1] [3]</p>
<p>Sources:</p>
<ol style="list-style-type: decimal">
<li>&quot;Kerberos.&quot; Ubuntu Documentation. November 18, 2014. Accessed September 25, 2016. https://help.ubuntu.com/community/Kerberos</li>
<li>&quot;Configuring Your Firewall to Work With Kerberos V5.&quot; Accessed September 25, 2016. https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-admin/Configuring-Your-Firewall-to-Work-With-Kerberos-V5.html</li>
<li>&quot;CentOS 7 Configure Kerberos KDC and Client.&quot; theurbanpengiun. September 5, 2016. Accessed September 25, 2016. https://www.youtube.com/watch?v=7Q-Xx0I8PXc</li>
</ol>
